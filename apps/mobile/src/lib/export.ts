import { Share } from 'react-native';

export async function exportCSV(data: Record<string, unknown>[], filename: string): Promise<void> {
  if (data.length === 0) return;

  const headers = Object.keys(data[0]);
  const csvContent = [
    headers.join(','),
    ...data.map(row =>
      headers.map(h => {
        const val = row[h];
        if (val === null || val === undefined) return '';
        const str = String(val);
        return str.includes(',') || str.includes('"') || str.includes('\n')
          ? `"${str.replace(/"/g, '""')}"`
          : str;
      }).join(',')
    ),
  ].join('\n');

  await Share.share({
    message: csvContent,
    title: `${filename}.csv`,
  });
}
